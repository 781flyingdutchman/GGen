import 'package:shaker/objects.dart';
import 'package:shaker/work.dart';
import 'package:test/test.dart';

void main() {
  test('Rectangle', () {
    var w = ShakerWork();
    var rect = Rect(Point(0, 0), Point(100, 100));
    w.addRectCut(rect);
    expect(
        w.gCode.toString(),
        equals(
            '[(Rectangle cut), G0 Z5.0000, G0 X-3.1750 Y-3.1750, G0 Z1.0000, G1 X-3.1750 Y-3.1750 Z-5.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-5.0000 F500.0000, G1 X103.1750 Y103.1750 Z-5.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-5.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-5.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-10.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-10.0000 F500.0000, G1 X103.1750 Y103.1750 Z-10.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-10.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-10.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-15.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-15.0000 F500.0000, G1 X103.1750 Y103.1750 Z-15.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-15.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-15.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-20.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-20.0000 F500.0000, G1 X103.1750 Y103.1750 Z-20.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-20.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-20.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-21.5000 F60.0000, G1 X-3.1750 Y103.1750 Z-21.5000 F500.0000, G1 X103.1750 Y103.1750 Z-21.5000 F500.0000, G1 X103.1750 Y-3.1750 Z-21.5000 F500.0000, G1 X-3.1750 Y-3.1750 Z-21.5000 F500.0000, G0 Z1.0000;  Rectangle cut done]'));
    w = ShakerWork();
    expect(() => w.addRectCut(rect, cutDepth: 10), throwsStateError);
    w.addRectCut(rect, cutDepth: -12, description: 'testCut');
    expect(w.gCode[0], equals('(testCut)'));
    expect(
        w.gCode.toString(),
        equals(
            '[(testCut), G0 Z5.0000, G0 X-3.1750 Y-3.1750, G0 Z1.0000, G1 X-3.1750 Y-3.1750 Z-5.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-5.0000 F500.0000, G1 X103.1750 Y103.1750 Z-5.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-5.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-5.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-10.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-10.0000 F500.0000, G1 X103.1750 Y103.1750 Z-10.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-10.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-10.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-12.0000 F60.0000, G1 X-3.1750 Y103.1750 Z-12.0000 F500.0000, G1 X103.1750 Y103.1750 Z-12.0000 F500.0000, G1 X103.1750 Y-3.1750 Z-12.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-12.0000 F500.0000, G0 Z1.0000;  Rectangle cut done]'));
  });

  test('Rectangle with tabs', () {
    var w = ShakerWork();
    var rect = Rect(Point(0, 0), Point(1000, 1000));
    w.addRectCut(rect, makeTabs: true);
    expect(w.gCode.toString(), equals('[(Rectangle cut), G0 Z5.0000, G0 X-3.1750 Y-3.1750, G0 Z1.0000, G1 X-3.1750 Y-3.1750 Z-5.0000 F60.0000, G1 X-3.1750 Y1003.1750 Z-5.0000 F500.0000, G1 X1003.1750 Y1003.1750 Z-5.0000 F500.0000, G1 X1003.1750 Y-3.1750 Z-5.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-5.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-10.0000 F60.0000, G1 X-3.1750 Y238.4125 Z-10.0000 F500.0000, G1 X-3.1750 Y238.4125 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y264.7625 Z-9.0000 F500.0000, G1 X-3.1750 Y264.7625 Z-10.0000 F60.0000, G1 X-3.1750 Y490.0000 Z-10.0000 F500.0000, G1 X-3.1750 Y490.0000 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y516.3500 Z-9.0000 F500.0000, G1 X-3.1750 Y516.3500 Z-10.0000 F60.0000, G1 X-3.1750 Y741.5875 Z-10.0000 F500.0000, G1 X-3.1750 Y741.5875 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y767.9375 Z-9.0000 F500.0000, G1 X-3.1750 Y767.9375 Z-10.0000 F60.0000, G1 X-3.1750 Y1003.1750 Z-10.0000 F500.0000, G1 X238.4125 Y1003.1750 Z-10.0000 F500.0000, G1 X238.4125 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X264.7625 Y1003.1750 Z-9.0000 F500.0000, G1 X264.7625 Y1003.1750 Z-10.0000 F60.0000, G1 X490.0000 Y1003.1750 Z-10.0000 F500.0000, G1 X490.0000 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X516.3500 Y1003.1750 Z-9.0000 F500.0000, G1 X516.3500 Y1003.1750 Z-10.0000 F60.0000, G1 X741.5875 Y1003.1750 Z-10.0000 F500.0000, G1 X741.5875 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X767.9375 Y1003.1750 Z-9.0000 F500.0000, G1 X767.9375 Y1003.1750 Z-10.0000 F60.0000, G1 X1003.1750 Y1003.1750 Z-10.0000 F500.0000, G1 X1003.1750 Y767.9375 Z-10.0000 F500.0000, G1 X1003.1750 Y767.9375 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y741.5875 Z-9.0000 F500.0000, G1 X1003.1750 Y741.5875 Z-10.0000 F60.0000, G1 X1003.1750 Y516.3500 Z-10.0000 F500.0000, G1 X1003.1750 Y516.3500 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y490.0000 Z-9.0000 F500.0000, G1 X1003.1750 Y490.0000 Z-10.0000 F60.0000, G1 X1003.1750 Y264.7625 Z-10.0000 F500.0000, G1 X1003.1750 Y264.7625 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y238.4125 Z-9.0000 F500.0000, G1 X1003.1750 Y238.4125 Z-10.0000 F60.0000, G1 X1003.1750 Y-3.1750 Z-10.0000 F500.0000, G1 X767.9375 Y-3.1750 Z-10.0000 F500.0000, G1 X767.9375 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X741.5875 Y-3.1750 Z-9.0000 F500.0000, G1 X741.5875 Y-3.1750 Z-10.0000 F60.0000, G1 X516.3500 Y-3.1750 Z-10.0000 F500.0000, G1 X516.3500 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X490.0000 Y-3.1750 Z-9.0000 F500.0000, G1 X490.0000 Y-3.1750 Z-10.0000 F60.0000, G1 X264.7625 Y-3.1750 Z-10.0000 F500.0000, G1 X264.7625 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X238.4125 Y-3.1750 Z-9.0000 F500.0000, G1 X238.4125 Y-3.1750 Z-10.0000 F60.0000, G1 X-3.1750 Y-3.1750 Z-10.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-15.0000 F60.0000, G1 X-3.1750 Y238.4125 Z-15.0000 F500.0000, G1 X-3.1750 Y238.4125 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y264.7625 Z-9.0000 F500.0000, G1 X-3.1750 Y264.7625 Z-15.0000 F60.0000, G1 X-3.1750 Y490.0000 Z-15.0000 F500.0000, G1 X-3.1750 Y490.0000 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y516.3500 Z-9.0000 F500.0000, G1 X-3.1750 Y516.3500 Z-15.0000 F60.0000, G1 X-3.1750 Y741.5875 Z-15.0000 F500.0000, G1 X-3.1750 Y741.5875 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y767.9375 Z-9.0000 F500.0000, G1 X-3.1750 Y767.9375 Z-15.0000 F60.0000, G1 X-3.1750 Y1003.1750 Z-15.0000 F500.0000, G1 X238.4125 Y1003.1750 Z-15.0000 F500.0000, G1 X238.4125 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X264.7625 Y1003.1750 Z-9.0000 F500.0000, G1 X264.7625 Y1003.1750 Z-15.0000 F60.0000, G1 X490.0000 Y1003.1750 Z-15.0000 F500.0000, G1 X490.0000 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X516.3500 Y1003.1750 Z-9.0000 F500.0000, G1 X516.3500 Y1003.1750 Z-15.0000 F60.0000, G1 X741.5875 Y1003.1750 Z-15.0000 F500.0000, G1 X741.5875 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X767.9375 Y1003.1750 Z-9.0000 F500.0000, G1 X767.9375 Y1003.1750 Z-15.0000 F60.0000, G1 X1003.1750 Y1003.1750 Z-15.0000 F500.0000, G1 X1003.1750 Y767.9375 Z-15.0000 F500.0000, G1 X1003.1750 Y767.9375 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y741.5875 Z-9.0000 F500.0000, G1 X1003.1750 Y741.5875 Z-15.0000 F60.0000, G1 X1003.1750 Y516.3500 Z-15.0000 F500.0000, G1 X1003.1750 Y516.3500 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y490.0000 Z-9.0000 F500.0000, G1 X1003.1750 Y490.0000 Z-15.0000 F60.0000, G1 X1003.1750 Y264.7625 Z-15.0000 F500.0000, G1 X1003.1750 Y264.7625 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y238.4125 Z-9.0000 F500.0000, G1 X1003.1750 Y238.4125 Z-15.0000 F60.0000, G1 X1003.1750 Y-3.1750 Z-15.0000 F500.0000, G1 X767.9375 Y-3.1750 Z-15.0000 F500.0000, G1 X767.9375 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X741.5875 Y-3.1750 Z-9.0000 F500.0000, G1 X741.5875 Y-3.1750 Z-15.0000 F60.0000, G1 X516.3500 Y-3.1750 Z-15.0000 F500.0000, G1 X516.3500 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X490.0000 Y-3.1750 Z-9.0000 F500.0000, G1 X490.0000 Y-3.1750 Z-15.0000 F60.0000, G1 X264.7625 Y-3.1750 Z-15.0000 F500.0000, G1 X264.7625 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X238.4125 Y-3.1750 Z-9.0000 F500.0000, G1 X238.4125 Y-3.1750 Z-15.0000 F60.0000, G1 X-3.1750 Y-3.1750 Z-15.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-20.0000 F60.0000, G1 X-3.1750 Y238.4125 Z-20.0000 F500.0000, G1 X-3.1750 Y238.4125 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y264.7625 Z-9.0000 F500.0000, G1 X-3.1750 Y264.7625 Z-20.0000 F60.0000, G1 X-3.1750 Y490.0000 Z-20.0000 F500.0000, G1 X-3.1750 Y490.0000 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y516.3500 Z-9.0000 F500.0000, G1 X-3.1750 Y516.3500 Z-20.0000 F60.0000, G1 X-3.1750 Y741.5875 Z-20.0000 F500.0000, G1 X-3.1750 Y741.5875 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y767.9375 Z-9.0000 F500.0000, G1 X-3.1750 Y767.9375 Z-20.0000 F60.0000, G1 X-3.1750 Y1003.1750 Z-20.0000 F500.0000, G1 X238.4125 Y1003.1750 Z-20.0000 F500.0000, G1 X238.4125 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X264.7625 Y1003.1750 Z-9.0000 F500.0000, G1 X264.7625 Y1003.1750 Z-20.0000 F60.0000, G1 X490.0000 Y1003.1750 Z-20.0000 F500.0000, G1 X490.0000 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X516.3500 Y1003.1750 Z-9.0000 F500.0000, G1 X516.3500 Y1003.1750 Z-20.0000 F60.0000, G1 X741.5875 Y1003.1750 Z-20.0000 F500.0000, G1 X741.5875 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X767.9375 Y1003.1750 Z-9.0000 F500.0000, G1 X767.9375 Y1003.1750 Z-20.0000 F60.0000, G1 X1003.1750 Y1003.1750 Z-20.0000 F500.0000, G1 X1003.1750 Y767.9375 Z-20.0000 F500.0000, G1 X1003.1750 Y767.9375 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y741.5875 Z-9.0000 F500.0000, G1 X1003.1750 Y741.5875 Z-20.0000 F60.0000, G1 X1003.1750 Y516.3500 Z-20.0000 F500.0000, G1 X1003.1750 Y516.3500 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y490.0000 Z-9.0000 F500.0000, G1 X1003.1750 Y490.0000 Z-20.0000 F60.0000, G1 X1003.1750 Y264.7625 Z-20.0000 F500.0000, G1 X1003.1750 Y264.7625 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y238.4125 Z-9.0000 F500.0000, G1 X1003.1750 Y238.4125 Z-20.0000 F60.0000, G1 X1003.1750 Y-3.1750 Z-20.0000 F500.0000, G1 X767.9375 Y-3.1750 Z-20.0000 F500.0000, G1 X767.9375 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X741.5875 Y-3.1750 Z-9.0000 F500.0000, G1 X741.5875 Y-3.1750 Z-20.0000 F60.0000, G1 X516.3500 Y-3.1750 Z-20.0000 F500.0000, G1 X516.3500 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X490.0000 Y-3.1750 Z-9.0000 F500.0000, G1 X490.0000 Y-3.1750 Z-20.0000 F60.0000, G1 X264.7625 Y-3.1750 Z-20.0000 F500.0000, G1 X264.7625 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X238.4125 Y-3.1750 Z-9.0000 F500.0000, G1 X238.4125 Y-3.1750 Z-20.0000 F60.0000, G1 X-3.1750 Y-3.1750 Z-20.0000 F500.0000, G1 X-3.1750 Y-3.1750 Z-21.5000 F60.0000, G1 X-3.1750 Y238.4125 Z-21.5000 F500.0000, G1 X-3.1750 Y238.4125 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y264.7625 Z-9.0000 F500.0000, G1 X-3.1750 Y264.7625 Z-21.5000 F60.0000, G1 X-3.1750 Y490.0000 Z-21.5000 F500.0000, G1 X-3.1750 Y490.0000 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y516.3500 Z-9.0000 F500.0000, G1 X-3.1750 Y516.3500 Z-21.5000 F60.0000, G1 X-3.1750 Y741.5875 Z-21.5000 F500.0000, G1 X-3.1750 Y741.5875 Z-9.0000 F120.0000;  tab, G1 X-3.1750 Y767.9375 Z-9.0000 F500.0000, G1 X-3.1750 Y767.9375 Z-21.5000 F60.0000, G1 X-3.1750 Y1003.1750 Z-21.5000 F500.0000, G1 X238.4125 Y1003.1750 Z-21.5000 F500.0000, G1 X238.4125 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X264.7625 Y1003.1750 Z-9.0000 F500.0000, G1 X264.7625 Y1003.1750 Z-21.5000 F60.0000, G1 X490.0000 Y1003.1750 Z-21.5000 F500.0000, G1 X490.0000 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X516.3500 Y1003.1750 Z-9.0000 F500.0000, G1 X516.3500 Y1003.1750 Z-21.5000 F60.0000, G1 X741.5875 Y1003.1750 Z-21.5000 F500.0000, G1 X741.5875 Y1003.1750 Z-9.0000 F120.0000;  tab, G1 X767.9375 Y1003.1750 Z-9.0000 F500.0000, G1 X767.9375 Y1003.1750 Z-21.5000 F60.0000, G1 X1003.1750 Y1003.1750 Z-21.5000 F500.0000, G1 X1003.1750 Y767.9375 Z-21.5000 F500.0000, G1 X1003.1750 Y767.9375 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y741.5875 Z-9.0000 F500.0000, G1 X1003.1750 Y741.5875 Z-21.5000 F60.0000, G1 X1003.1750 Y516.3500 Z-21.5000 F500.0000, G1 X1003.1750 Y516.3500 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y490.0000 Z-9.0000 F500.0000, G1 X1003.1750 Y490.0000 Z-21.5000 F60.0000, G1 X1003.1750 Y264.7625 Z-21.5000 F500.0000, G1 X1003.1750 Y264.7625 Z-9.0000 F120.0000;  tab, G1 X1003.1750 Y238.4125 Z-9.0000 F500.0000, G1 X1003.1750 Y238.4125 Z-21.5000 F60.0000, G1 X1003.1750 Y-3.1750 Z-21.5000 F500.0000, G1 X767.9375 Y-3.1750 Z-21.5000 F500.0000, G1 X767.9375 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X741.5875 Y-3.1750 Z-9.0000 F500.0000, G1 X741.5875 Y-3.1750 Z-21.5000 F60.0000, G1 X516.3500 Y-3.1750 Z-21.5000 F500.0000, G1 X516.3500 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X490.0000 Y-3.1750 Z-9.0000 F500.0000, G1 X490.0000 Y-3.1750 Z-21.5000 F60.0000, G1 X264.7625 Y-3.1750 Z-21.5000 F500.0000, G1 X264.7625 Y-3.1750 Z-9.0000 F120.0000;  tab, G1 X238.4125 Y-3.1750 Z-9.0000 F500.0000, G1 X238.4125 Y-3.1750 Z-21.5000 F60.0000, G1 X-3.1750 Y-3.1750 Z-21.5000 F500.0000, G0 Z1.0000;  Rectangle cut done]'));
    var numTabs = w.gCode.where((element) => element.contains('tab')).toList().length;
    expect(numTabs, 48);
    w = ShakerWork();
    rect = Rect(Point(0, 0), Point(100, 1000)); //  no tabs on horizontal
    w.addRectCut(rect, makeTabs: true);
    numTabs = w.gCode.where((element) => element.contains('tab')).toList().length;
    expect(numTabs, 24);
    w = ShakerWork();
    rect = Rect(Point(0, 0), Point(1000, 100)); //  no tabs on vertical
    w.addRectCut(rect, makeTabs: true);
    numTabs = w.gCode.where((element) => element.contains('tab')).toList().length;
    expect(numTabs, 24);
    w = ShakerWork();
    rect = Rect(Point(0, 0), Point(100, 100)); //  no tabs on either
    w.addRectCut(rect, cutDepth: -10, makeTabs: true);  // shallow, only one tab
    numTabs = w.gCode.where((element) => element.contains('tab')).toList().length;
    expect(numTabs, 0);
    w = ShakerWork();
    rect = Rect(Point(0, 0), Point(1000, 1000));
    w.addRectCut(rect, cutDepth: -10, makeTabs: true);  // shallow, only one tab
    numTabs = w.gCode.where((element) => element.contains('tab')).toList().length;
    expect(numTabs, 12);
  });
}
